title: 'MIT 6.824 - Frangipani: A Scalable Distributed File System'
tags:
- MIT 6.824
- Paper
- Distributed Systems
---

## 介绍
这是一篇上世纪九十年代的论文，在当时的环境下，安装新工作站的需求与日俱增，而针对大量工作站的文件系统管理却费时费力。为了保存更多的文件和服务更多的用户，就需要更多的磁盘，并挂载到更多的机器上。某一组文件经常会被手动分配给某些特定的磁盘，当磁盘空间不足，异常或者成为性能热点时，就需要手动移动或者复制文件到其他磁盘上。使用 `RAID` 技术管理多个磁盘只能解决部分问题；当系统增长到需要多个磁盘阵列和多台服务器时，系统管理问题也随之而来。

`Frangipani` 是一个可扩展的分布式文件系统，它能统一管理挂载在不同机器上的磁盘，对外来说，这些磁盘构成了一个独立的共享存储池。组成 `Frangipani` 的机器默认能够被统一管理而且相互间能安全的通信。在 `Frangipani` 之前已经有了一些分布式文件系统的实现，并且在吞吐和容量上有很好的扩展性。`Frangipani` 的一个显著特性是它的内部结构非常简单——各台协作的机器共同访问一个通用的存储，并使用锁来保证访问的同步性。这种简单的结构使得只需要少量的机器就能处理系统恢复，重配置和负载均衡。`Frangipani` 的另一个关键特性是相比于已知的分布式文件系统，它结合了一系列功能使得 `Frangipani` 更易于使用和管理：

1. 所有用户读取到的文件内容都相同。
2. 可以轻易的向 `Frangipani` 添加更多的服务器来增加存储容量和吞吐，而无需修改已有服务器的配置，或者中断其操作。这些服务器可以像积木一样根据需要搭建来构建更大的文件系统。
3. 系统管理员添加新用户时无需关心新用户的数据会由哪台服务器管理或者保存在哪个磁盘上。
4. 系统管理员可以对整个文件系统进行完整和一致的备份，而无需停止服务。备份可以在线进行，使得用户可以快速访问被意外删除的文件。
5. 文件系统可以在无需人工干预的情况下容忍机器、网络、磁盘异常并自行恢复。

`Frangipani` 构建于 `Petal` 之上，`Petal` 是一个易于管理的分布式存储系统，为客户端提供了虚拟磁盘。和物理磁盘一样，`Petal` 的虚拟磁盘也是以块（`block`）的方式来读取和写入存储。和物理磁盘不同的是，一个 `Petal` 虚拟磁盘提供了$2^{64}$字节的稀疏地址空间，并且只在需要的时候才会分配物理存储。`Petal` 也支持对数据备份来保证高可用。`Petal` 同时提供了高效的快照功能来支持一致性备份。`Frangipani` 从下层存储系统继承了扩展性，容错和易于管理的特性，不过将这些特性扩展到文件系统还需要些细致的设计。下一节将会详细描述 `Frangipani` 的结构以及和 `Petal` 的关系。

![alt](/images/frangipani-1.png)

上图展示了 `Frangipani` 的层级设计。多个可替换的 `Frangipani` 服务器运行于一个共享的 `Petal` 虚拟磁盘之上，不同的用户程序可以各自通过连接的 `Frangipani` 服务器来访问相同的文件，而各 `Frangipani` 服务器间通过分布式锁服务来保证数据的一致性。通过添加 `Frangipani` 服务器可以实现对文件系统层的扩展。`Frangipani` 通过异常服务器的自动恢复和借助依然存活的服务器提供服务来实现容错。相比于中心化的网络文件服务器，`Frangipani` 通过将负载分摊到正在使用文件的机器上来提供更好的负载均衡。出于扩展性，容错和负载均衡的考虑，`Petal` 和 `Frangipani` 用到的锁服务也是分布式的。

`Frangipani` 服务器默认信任 `Petal` 服务器和锁服务。`Frangipani` 在设计时的最佳使用场景是在同一个管理域下的工作站集群，虽然它也可以扩展到其他管理域下。因此，`Frangipani` 可以被看做是一个集群文件系统。

论文的作者在 `DIGITAL Unix 4.0` 之上实现了 `Frangipani`。得益于 `Frangipani` 在 `Petal` 之上构建的简洁的层级设计，使得在几个月内实现了一个可用的系统。

## 参考
* [Frangipani: A Scalable Distributed File System](https://pdos.csail.mit.edu/6.824/papers/thekkath-frangipani.pdf)