title: 'MIT 6.824 - In Search of an Understandable Consensus Algorithm (Extended Version)'
tags:
- MIT 6.824
- Paper
---

## 介绍
共识算法使得一批机器作为一个整体对外提供服务，同时当部分机器异常时系统仍能保证可用性。因此，共识算法在构建可靠的大型软件系统中扮演着至关重要的角色。而在所有的共识算法中，`Paxos` 占据了主导的地位：大部分共识算法的实现都是基于 `Paxos` 或者受其影响，并且它也成为了教授学生们共识算法的第一选择。

然而，尽管人们为了让 `Paxos` 易于理解做了大量的尝试，`Paxos` 依然非常难以理解。另外，如果要将 `Paxos` 应用到实际的系统中需要涉及复杂的修改。因此，系统开发人员和学生都受困于 `Paxos`。

在受困于 `Paxos` 之后，`Raft` 的作者开始尝试设计一种新的共识算法，从而能够为系统构建和教学提供一个更好的基础。和常见的共识算法的设计目标不同，这个新的共识算法的首要设计目标是可理解性：能否为实际的系统设计一个共识算法，并且远比 `Paxos` 易于理解？另外，对于系统构建者来说这个算法需要能易于实现。这个算法仅仅是正确的还不够，重要的是能显而易见的被人们理解为什么是正确的。

这个新的共识算法就是 `Raft`。在设计 `Raft` 时为了提高可理解性作者做了些特定的处理，包括解耦（`Raft` 分离了选主，日志复制和安全性的处理）和减少了状态机的状态（相比于 `Paxos`，`Raft` 减少了非确定性的状态以及各服务器间不一致的情况）。根据两所大学共43名学生的调查反馈，`Raft` 明显比 `Paxos` 易于理解：在学习了两种共识算法后，有33名学生在回答关于 `Raft` 的问题时比回答关于 `Paxos` 的问题表现的更好。

`Raft` 和现今存在的共识算法有很多相之处（特别是 `Oki` 和 `Liskov` 的 `Viewstamped Replication`），不过也有几个方面的创新：

* 强主节点：相比于其他共识算法，`Raft` 使用了更严格的主节点要求。例如，日志只会从主节点发往其他服务器。这简化了日志复制的管理，同时也使得 `Raft` 更易于理解。
* 选主：`Raft` 使用随机计时器来进行选主（后面会提到主节点和各从节点间会维持一个心跳，如果在一段时间内从节点没有收到心跳，那么就可以认为主节点异常，可以重新发起选主，对于每个从节点来说，这个等待的时间不是固定的，而是随机的）。因为心跳本身在共识算法中是一个必不可少的技术，使用随机计时器仅仅在这之上增加了一些额外的机制，却能简单快速的解决选主冲突问题（例如有两个节点瓜分了存活着的节点的全部选票，却没有任何一个节点获得了超过半数的选票，需要重新选主）。
* 节点变更：当集群中的节点需要变更时，`Raft` 使用 `joint consensus` 机制来保证在调整时新旧两套集群下过半数的机器同时属于两套集群。这就保证了整个集群在节点变更时依然正常对外提供服务。

参考：

* [In Search of an Understandable Consensus Algorithm (Extended Version)](https://pdos.csail.mit.edu/6.824/papers/raft-extended.pdf)
* [Raft: Understandable Distributed Consensus](http://thesecretlivesofdata.com/raft/)
* [Students' Guide to Raft](https://thesquareplanet.com/blog/students-guide-to-raft/)