title: '【读】Pinot: Realtime OLAP for 530 Million Users'
tags:
- Paper
- Pinot
- Distributed Systems
- Database
---

## 介绍
作者对大数据时代下近实时的 `OLAP` 服务提出了如下要求：

* 高性能：系统应当能够快速的返回用户的查询请求
* 可扩展性：为了能够在处理大量并发查询请求的同时做到近实时的消费大量数据，系统应当提供近线性的扩展性和容错性来满足大规模的服务部署
* 低成本：随着数据容量以及查询并发量的增加，系统的成本不能无限制的增长
* 低延迟的实时数据消费：用户期望能够近实时的查询到刚添加到系统中的数据
* 灵活性：系统应当能够支持用户查询时下钻到任意维度，而不受限于预聚合的数据；同时，系统也能够以零停机的方式在生产环境增加新的查询模式
* 容错性：系统异常时能够提供优雅的服务降级
* 非中断式运维：系统能够以零停机的方式进行服务升级或者表的模式变更
* 云服务友好的架构：系统应当能够轻易的部署到商用的云服务环境中

## 架构
`Pinot` 诞生自 `LinkedIn`，作为一款可扩展的分布式 `OLAP` 数据库，能够提供低延迟的实时数据分析。`Pinot` 构建在不可变的追加式数据存储之上，专门为数据分析查询场景作了优化，数据自开始接入到可被查询可以在几秒内完成。

在 `LinkedIn` 中，业务数据会先接入到 `Kafka` 中，然后经过 `ETL` 处理存储到 `HDFS`。`Pinot` 既支持近实时的从 `Kafka` 中消费数据，也支持从类似 `Hadoop` 的离线系统中导入数据。因此，`Pinot` 遵循 `lambda` 架构，能够自动合并从 `Kafka` 接入的流式数据和 `Hadoop` 导入的离线数据。

### 数据和查询模型
和常见的数据块一样，`Pinot` 也以表的方式管理数据，每个表背后由 `schema` 定义了有哪些列。支持的数据类型包括不同长度的整型，浮点数，字符串，布尔值，以及基于这些数据类型的数组。`Pinot` 中的列即可也是 `dimension`，也可以是 `metric`。

`Pinot` 还支持一个特殊的时间列，一方面在查询时基于该列合并流式数据和离线数据，另一方面作为数据过期判断的依据。

`Pinot` 的表以 `segment` 为单位存储，每个 `segment` 一般能存储几千万条记录，一张表能支持几万个 `segment`。`segment` 可以有副本，从而确保数据的高可用性。`segment` 中的数据是不可修改的，但是可以整个替换 `segment` 来更新数据（数据更新代价较大）。

`segment` 采用列存储保存数据，并支持多种编码策略来减少单个 `segment` 的大小。一个 `segment` 的大小一般在几百 `MB` 到几 `GB` 不等。

`Pinot` 的查询语言为 `PQL`，为 `SQL` 的子集，支持 `select`，`projection`，`aggregation`，和 `top-n` 查询，不过不支持连接和嵌套查询。`PQL` 不支持单条记录级别的创建，更新或者删除。

### 组件

## 参考
* [Pinot: Realtime OLAP for 530 Million Users](https://dl.acm.org/doi/10.1145/3183713.3190661)
